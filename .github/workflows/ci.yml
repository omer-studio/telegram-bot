# CI/CD Pipeline for Python Telegram Bot
# קובץ זה מריץ deployment ל-Render
# הוסרו הבדיקות האוטומטיות למניעת שגיאות במייל

name: 🤖 Python Bot CI/CD

# מתי להריץ את ה-workflow
on:
  # כל push לענף main
  push:
    branches: [ main ]
  
  # כל pull request לענף main
  pull_request:
    branches: [ main ]

# משתני סביבה גלובליים
env:
  PYTHON_VERSION: "3.11"

jobs:
  # Deploy ל-Render (ללא בדיקות מוקדמות)
  deploy:
    name: 🚀 Deploy to Render
    runs-on: ubuntu-latest
    
    # יריץ רק על push לmain (לא על pull requests)
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    
    steps:
      # 1. Deploy ל-Render דרך Deploy Hook
      - name: 🚀 Trigger Render Deploy
        env:
          # ✅ GitHub Actions secret - IDE warning is false positive, works perfectly in GitHub Actions
          RENDER_DEPLOY_HOOK_URL: ${{ secrets.RENDER_DEPLOY_HOOK_URL }}
        run: |
          echo "🔄 מתחיל deployment ל-Render..."
          
          # שליחת POST request ל-Render Deploy Hook
          echo "🔄 שולח Deploy Hook ל-Render..."
          
          # שליחת הקריאה
          if curl -v --max-time 30 --retry 3 --retry-delay 2 --fail-with-body "$RENDER_DEPLOY_HOOK_URL"; then
            echo ""
            echo "✅ Deploy Hook נשלח בהצלחה ל-Render!"
            echo "🎉 הdeployment החל - תוכל לעקוב אחר ההתקדמות ב-Render Dashboard"
          else
            CURL_EXIT_CODE=$?
            echo ""
            echo "❌ שגיאה בשליחת Deploy Hook (Exit Code: $CURL_EXIT_CODE)"
            exit 1
          fi
          
      # 2. הודעת סיכום
      - name: ✅ Deployment Summary
        run: |
          echo "🎯 סיכום Deployment:"
          echo "📅 זמן: $(date)"
          echo "🌿 ענף: ${{ github.ref_name }}"
          echo "📝 Commit: ${{ github.sha }}"
          echo "👤 מבצע: ${{ github.actor }}"
          echo "🚀 סטטוס: הושלם בהצלחה!"